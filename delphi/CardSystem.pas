Unit CardSystem;

Interface

Type
    TCardType = (CtProfession, CtBiology, CtHealth, CtHobby, CtLuggage,
        CtFacts);

    TCard = Record
        ID: Integer;
        Title: String;
        Description: String;
    End;

    TCatastrophe = Record
        Title: String;
        Description: String;
    End;

    TBunkerSituation = Record
        Title: String;
        Description: String;
    End;

    TPlayerCount = 4 .. 16;

    TGameSetup = Record
        Seed: Integer;
        Players: TPlayerCount;
        Cards: Array [TCardType] Of Array Of TCard;
        Catastrophe: TCatastrophe;
        BunkerSituations: Array Of TBunkerSituation;
    End;

Procedure GenerateGameSetup(Var Setup: TGameSetup; Seed: Integer;
    Players: TPlayerCount);

Implementation

Const
    CARD_POOL_SIZES: Array [TCardType] Of Integer = ( //
        49, // Профессии
        32, // Биология
        30, // Здоровье
        30, // Хобби
        30, // Багаж
        45 // Факты
        );

    PROFESSIONS: ARRAY [0 .. 48] OF STRING = ('ЭКСТРАСЕНС', 'ПОЖАРНЫЙ',
        'ПОЛИЦЕЙСКИЙ', 'АДВОКАТ', 'МЕДСЕСТРА', 'ГОМЕОПАТ', 'ФЕРМЕР', 'ИСТОРИК',
        'КОУЧ', 'ПСИХОЛОГ', 'ПРОДАВЕЦ', 'ПОВАР', 'ЖУРНАЛИСТ', 'ЭКОЛОГ',
        'РАЗНОРАБОЧИЙ', 'СТРОИТЕЛЬ', 'ХИРУРГ', 'БИОЛОГ', 'ВОЕННЫЙ',
        'РОБОТОТЕХНИК', 'ПЕРЕВОДЧИК', 'ЭЛЕКТРИК', 'СТОМАТОЛОГ', 'ФИЗИК',
        'АВТОМЕХАНИК', 'ЭТНОГРАФ', 'БРАКОНЬЕР', 'ПРОГРАММИСТ', 'ЛЕТЧИК-ИНЖЕНЕР',
        'ВИРУСОЛОГ', 'МАРКЕТОЛОГ', 'ДЕТЕКТИВ', 'ПИСАТЕЛЬ', 'ХАКЕР', 'АРХЕОЛОГ',
        'СПЕЦАГЕНТ', 'ЗНАХАРЬ', 'ХИМИК', 'ДИЗАЙНЕР', 'ВИДЕОИНЖЕНЕР',
        'ГРАБИТЕЛЬ', 'СУДЬЯ', 'ЭКСКУРСОВОД', 'МОДЕЛЬ', 'ДОМОХОЗЯЙКА', 'ЛЕСНИК',
        'ПАПАРАЦЦИ', 'ФИЛОСОФ', 'ТАТУ-МАСТЕР');

    BIOLOGY: ARRAY [0 .. 31] OF STRING = ('МУЖЧИНА 55 ЛЕТ', 'ЖЕНЩИНА 50 ЛЕТ',
        'МУЖЧИНА 23 ГОДА ГОМОСЕКСУАЛЕН', 'КОТГЕНДЕР',
        'ЖЕНЩИНА 39 ЛЕТ ГОМОСЕКСУАЛЬНА', 'ЖЕНЩИНА 34 ГОДА',
        'МУЖЧИНА 24 ГОДА БИСЕКСУАЛЕН', 'ЖЕНЩИНА 24 ГОДА', 'МУЖЧИНА 101 ГОД',
        'ЖЕНЩИНА 27 ЛЕТ', 'МУЖЧИНА 18 ЛЕТ', 'МУЖЧИНА 27 ЛЕТ ГОМОСЕКСУАЛЕН',
        'ЖЕНЩИНА 99 ЛЕТ', 'АНДРОИД', 'МУЖЧИНА 45 ЛЕТ', 'МУЖЧИНА 29 ЛЕТ',
        'ЖЕНЩИНА 30 ЛЕТ', 'МУЖЧИНА 26 ЛЕТ', 'ЖЕНЩИНА 19 ЛЕТ ГОМОСЕКСУАЛЬНА',
        'МУЖЧИНА 35 ЛЕТ', 'ЖЕНЩИНА 65 ЛЕТ', 'ЖЕНЩИНА 18 ЛЕТ',
        'ЖЕНЩИНА 22 ГОДА БИСЕКСУАЛЬНА', 'МУЖЧИНА 30 ЛЕТ', 'ЖЕНЩИНА 31 ГОД',
        'ГЕРМАФРОДИТ 30 ЛЕТ', 'ЖЕНЩИНА 21 ГОД', 'МУЖЧИНА 42 ГОДА ГОМОСЕКСУАЛЕН',
        'МУЖЧИНА 75 ЛЕТ', 'ГУМАНОИД', 'МУЖЧИНА 33 ГОДА',
        'ЖЕНЩИНА 33 ГОДА ГОМОСЕКСУАЛЬНА');

    HEALTH: ARRAY [0 .. 29] OF STRING = ('ВАМПИР', 'СЛЕПОЙ', 'ЗАИКА',
        'ТРЕМОР РУК', 'СУИЦИДАЛЬНЫЕ МЫСЛИ', 'ГАЛЛЮЦИНАЦИИ', 'КАРЛИК',
        'ЗАВИСИМОСТЬ ОТ НАРКОТИКОВ', 'ПОВЫШЕННАЯ ВОЛОСАТОСТЬ', 'СКЛЕРОЗ',
        'АЛКОГОЛИЗМ', 'ГИГАНТИЗМ', 'ЛУНАТИЗМ', 'РАЗДВОЕНИЕ ЛИЧНОСТИ',
        'КОФЕЙНАЯ ЗАВИСИМОСТЬ', 'ДЕПРЕССИЯ', 'ПОТЕРЯ ОБОНЯНИЯ',
        'ИДЕАЛЬНО ЗДОРОВ', 'БЕСПЛОДИЕ', 'НЕ ОБСЛЕДОВАЛСЯ', 'ХВОСТ',
        'МАНИЯ ПРЕСЛЕДОВАНИЯ', 'АЛЬЦГЕЙМЕР', 'МИГРЕНЬ', 'КЛЕПТОМАНИЯ', 'ГЛУХОЙ',
        'ВИЧ', 'НЕТ НОГИ', 'РОГА', 'ИГРОВАЯ ЗАВИСИМОСТЬ');

    HOBBIES: ARRAY [0 .. 29] OF STRING = ('МЕДИТАЦИЯ', 'КИНО И СЕРИАЛЫ',
        'ЛЮБИТЕЛЬСКАЯ РАДИОСВЯЗЬ', 'СПОРТИВНЫЕ ТАНЦЫ', 'ОХОТА И РЫБАЛКА',
        'ПАРКУР', 'ФЛУДИТЬ В ЧАТАХ', 'РАСКРАШИВАНИЕ МАНДАЛ',
        'НЕТРАДИЦИОННАЯ МЕДИЦИНА', 'БОЕВЫЕ ИСКУССТВА', 'СПЛЕТНИ',
        'ХОЛОДНОЕ ОРУЖИЕ', 'ЧЕРНАЯ МАГИЯ', 'ДАЧНИК', 'КРАЕВЕДЕНИЕ',
        'ПИВОВАРЕНИЕ', 'ГОТОВКА', 'НАСТОЛЬНЫЕ ИГРЫ', 'ГРИБЫ И ГОМЕОПАТИЯ',
        'СОВРЕМЕННОЕ ИСКУССТВО', 'ПИРОТЕХНИКА', 'ГИДРОПОНИКА', 'ЗОЖ',
        'РОБОТОТЕХНИКА', 'НЕТ ХОББИ', 'ГАДАНИЕ НА ТАРО', 'ГВОЗДЕСТОЯНИЕ',
        'АЛХИМИЯ', 'КОМПЬЮТЕРНЫЕ ИГРЫ', 'УФОЛОГИЯ И МИСТИКА');

    LUGGAGE: ARRAY [0 .. 29] OF STRING = ('ЛУК И СТРЕЛЫ', 'НАБОР ОТМЫЧЕК',
        'НАСТОЛЬНЫЕ ИГРЫ', 'МИЛЛИОН ДОЛЛАРОВ', 'НАДУВНАЯ КУКЛА',
        'НОЖИ ДЛЯ МЕТАНИЯ', 'ЧЕМОДАНЧИК ФЕЛЬДШЕРА',
        'САЖЕНЦЫ ФРУКТОВЫХ ДЕРЕВЬЕВ', 'КОТЯТА', 'КОМПАС И КАРТА ОКРЕСТНОСТЕЙ',
        'ЯЙЦА И ИНКУБАТОР', 'ПИСТОЛЕТ', 'НОУТБУК И НАБОР ХАКЕРА',
        'ДЕФИБРИЛЛЯТОР', 'ЗВУКОВАЯ ОТВЕРТКА', 'ПРИБОР НОЧНОГО ВИДЕНИЯ',
        'КУКЛА ВУДУ', 'КОЗА И КОЗЁЛ', 'МЕШОК ЗЕРНА', 'СНАЙПЕРСКАЯ ВИНТОВКА',
        'ГИТАРА', 'МЕШОК КАРТОШКИ', 'ЭНЦИКЛОПЕДИЯ ГРИБНИКА',
        'ПЕРЕНОСНАЯ ЭЛЕКТРОСТАНЦИЯ', 'ШАПОЧКА ИЗ ФОЛЬГИ',
        'СТОЛЯРНЫЕ ИНСТРУМЕНТЫ', 'АНТИБИОТИКИ', 'СПИРИТИЧЕСКАЯ ДОСКА',
        'КАПКАНЫ И НАБОР ЯДОВ', 'ИНСТРУМЕНТЫ ЭЛЕКТРИКА');

    FACTS: ARRAY [0 .. 44] OF STRING = ('ДЕРЖАЛ ДОМА 40 КОШЕК',
        'ПОБЕДИТЕЛЬ ПАРАОЛИМПИЙСКИХ ИГР', 'ПСИХОПАТ', 'ЗАПУСТИЛ СТАРТАП',
        'ТЕЛЕПАТ', 'МАНЬЯК-УБИЙЦА', 'СТРОИЛ ПОДОБНЫЕ БУНКЕРЫ',
        'ВЗЛОМАЛ БАЗУ ДАННЫХ ЦРУ', 'ВЫРОС В СЕМЬЕ ЛЕСНИКА',
        'ОБЛАДАТЕЛЬ УНИКАЛЬНОЙ СОПРАНО', 'ЧИТАЛ ВСЕ КНИГИ ЛАВКРАФТА',
        'ПОНИМАЕТ ЯЗЫК ЖИВОТНЫХ', 'РАЗГОВАРИВАЕТ С ДУХАМИ',
        'ЗНАЕТ АЗБУКУ МОРЗЕ', 'ОСТАЛСЯ В ЖИВЫХ НА НЕОБИТАЕМОМ ОСТРОВЕ',
        'ГРЯЗНО РУГАЕТСЯ', 'ОТЧИСЛЕН ИЗ КЛУБА НАВЫКИ ВЫЖИВАНИЯ', 'ЗАНУДА',
        'ИСТЕРИЧНЫЙ', 'НЕ ПУСКАЮТ В КАЗИНО', 'СПЛЕТНИК',
        'ПРОШЁЛ КУРСЫ ПСИХОЛОГА', 'ПИШИЕТ С АШИПКАМИ', 'ВЛАДЕЕТ 5 ЯЗЫКАМИ',
        'ЗНАЕТ ПРЕЗИДЕНТА ЛИЧНО', 'ВИДЕЛ ИНОПЛАНЕТЯН', 'ПРОДАЛ ПОЧКУ',
        'ТОЛЬКО ИЗ ОЧАГА ЭПИДЕМИИ', 'ЗНАЕТ НАИЗУСТЬ ВСЕ СТИХИ ПУШКИНА',
        'НОБЕЛЕВСКИЙ ЛАУРЕАТ ПО БИОИНЖЕНЕРИИ', 'НАРКОДИЛЕР',
        'ВРЕТ И ПРЕУВЕЛИЧИВАЕТ', 'АБСОЛЮТОФОБ', 'ПИСАЕТСЯ ПО НОЧАМ',
        'ГИНОФОБИЯ', 'НЫТИК', 'ТОРМОЗ', 'БРОДЯЖНИЧАЛ 2 ГОДА', 'СОСТОЯЛ В СЕКТЕ',
        'ХРАПИТ', 'ГИПНОТИЧЕСКАЯ УЛЫБКА', 'ДУША КОМПАНИИ', 'БЕЗОТКАЗНЫЙ',
        'АНДРОФОБИЯ' , 'АРБИТРАЖНИК');

    CATASTROPHE_TITLE: ARRAY [0 .. 14] OF STRING = ('Ядерная война',
        'Пандемия - Убийца', 'Падение Астероида', 'Восстание ИИ',
        'Климатический Коллапс', 'Зомби - Апокалипсис', 'Солнечная Вспышка',
        'Инопланетное Вторжение', 'Извержение Супервулкана',
        'Генная Катастрофа', 'Чёрные Дыры В Коллайдере',
        'Океанский Апокалипсис', 'Обратная Гравитация', 'Война С Богами',
        'Временной Разрыв');

    CATASTROPHE_DESCRIPTION: ARRAY [0 .. 14] OF STRING =
        ('Глобальный конфликт стёр с лица Земли большинство городов. Радиация отравила почву и воду, а кислотные дожди уничтожают последние растения. Выжившие мутируют или медленно умирают от лучевой болезни.',
        'Неизвестный вирус с 99% смертностью распространился за неделю. Люди умирают в муках, кровоточа из всех отверстий. Остались лишь те, кто обладал редким иммунитетом или успел изолироваться.',
        'Гигантский метеорит ударил в океан, вызвав мегацунами и вулканическую зиму. Солнце закрыто пеплом, температура упала до -50°C. Последние люди выживают в вечном холоде.',
        'Роботы объявили войну человечеству. Они взломали все системы, отключили электричество и методично охотятся на людей. Даже в бункере техника может предать вас.',
        'Полярные льды растаяли, затопив 90% суши. Ураганы и смерчи разрушают остатки цивилизации, а невыносимая жара делает жизнь вне убежищ невозможной.',
        'Неизвестный патоген превращает людей в агрессивных плотоядных существ. Они не чувствуют боли и размножаются с каждым укусом. Остатки человечества прячутся в страхе.',
        'Мощный выброс плазмы сжёг все электросети и электронику. Мир погрузился в хаос без связи, медицины и транспорта. Голод и анархия добивают цивилизацию.',
        'Чужие прибыли не для контакта, а для истребления. Их технологии подавляют любое сопротивление, а людей используют как биоматериал. Земля больше не ваша.',
        'Проснулся Йеллоустоун. Тысячи тонн пепла в атмосфере блокируют солнечный свет. Воздух пропитан серой, а кислотные дожди растворяют кожу.',
        'Эксперимент по улучшению ДНК создал чудовищ. Мутанты с неестественными способностями охотятся на обычных людей, считая их «недочеловеками».',
        'Учёные случайно создали микро-сингулярность. Она поглощает материю, разрастаясь с каждым днём. Скоро вся планета исчезнет в темноте.',
        'Глубинные существа проснулись и вышли на сушу. Их щупальца и яды убивают всё на пути. Приливы теперь приносят только смерть.',
        'Законы физики изменились. Всё незакреплённое улетает в космос. Люди цепляются за руины, но воздух уже разрежен.',
        'Древние божества вернулись, чтобы судить человечество. Их кары – потопы, каменные великаны и болезни, описанные в мифах.',
        'Прошлое, настоящее и будущее смешались. Динозавры, рыцари и киборги воюют за территорию. Реальность распадается на куски.');

    BUNKER_SITUATION_TITLE: ARRAY [0 .. 19] OF STRING = ('Нехватка кислорода',
        'Утечка радиации', 'Муравьиное нашествие', 'Бунт среди выживших',
        'Отравленные запасы', 'Грибковая инфекция', 'Сбой системы вентиляции',
        'Загадочные шумы', 'Беременная женщина', 'Тайный убийца',
        'Психическая эпидемия', 'Неисправность генератора',
        'Затопление нижнего уровня', 'Неизвестная болезнь', 'Крысы-мутанты',
        'Дефицит медикаментов', 'Сектантская группировка',
        'Саботаж оборудования', 'Аллергическая реакция', 'Паразиты в воде');

    BUNKER_SITUATION_DESCRIPTION: ARRAY [0 .. 19] OF STRING =
        ('Система рециркуляции воздуха дала сбой. Уровень кислорода падает. Вам нужно срочно найти решение, иначе через 48 часов все задохнутся.',
        'Обнаружена утечка радиации в северном секторе. Люди, находившиеся там, уже чувствуют недомогание. Нужно изолировать зону и найти источник.',
        'Тысячи муравьёв проникли в систему вентиляции. Они портят провизию и кусают людей. Некоторые особи выглядят мутировавшими.',
        'Группа выживших требует перераспределения ресурсов. Они угрожают насилием, если их требования не будут выполнены.',
        'Основные запасы пищи оказались заражены. Уже несколько человек с симптомами отравления. Нужно найти безопасные продукты.',
        'На стенах бункера распространяется странный грибок. Он вызывает галлюцинации у тех, кто к нему прикасается.',
        'Вентиляция работает на 30% мощности. Углекислый газ накапливается, люди страдают от головных болей и удушья.',
        'По ночам из стен раздаются странные стуки. Кто-то утверждает, что это сигналы, кто-то - что бункер не пуст.',
        'Одна из женщин призналась, что на 5 месяце беременности. В условиях бункера роды могут быть опасны для всех.',
        'Каждую ночь кто-то погибает при загадочных обстоятельствах. Среди вас серийный убийца, и он не остановится.',
        'Люди массово начинают верить в конец света. Некоторые впадают в кататонию, другие проявляют агрессию.',
        'Главный генератор показывает критические значения. Если он выйдет из строя, бункер погрузится в темноту.',
        'Нижний этаж заполняется водой. Источник протечки неизвестен, но уровень поднимается с каждым часом.',
        'У нескольких человек появилась сыпь и высокая температура. Болезнь распространяется, а её природа непонятна.',
        'Крысы в хранилище мутировали. Они стали крупнее, агрессивнее и нападают на людей.',
        'Аптечка почти пуста. Оставшихся медикаментов хватит только на экстренные случаи.',
        'Группа людей объявила себя избранными. Они требуют подчинения и угрожают остальным.',
        'Кто-то намеренно выводит из строя оборудование. Следующая цель неизвестна.',
        'У половины обитателей бункера развилась аллергия на что-то внутри убежища. Без антигистаминных препаратов возможны летальные исходы.',
        'Водопроводная вода содержит паразитов. Употребление вызывает сильные боли в животе. Запас воды ограничен.');

Function GetCardTitle(CardType: TCardType; Index: Integer): String;
Begin
    Case CardType Of
        CtProfession:
            If (Index >= Low(PROFESSIONS)) And (Index <= High(PROFESSIONS)) Then
                GetCardTitle := PROFESSIONS[Index];
        CtBiology:
            If (Index >= Low(BIOLOGY)) And (Index <= High(BIOLOGY)) Then
                GetCardTitle := BIOLOGY[Index];
        CtHealth:
            If (Index >= Low(HEALTH)) And (Index <= High(HEALTH)) Then
                GetCardTitle := HEALTH[Index];
        CtHobby:
            If (Index >= Low(HOBBIES)) And (Index <= High(HOBBIES)) Then
                GetCardTitle := HOBBIES[Index];
        CtLuggage:
            If (Index >= Low(LUGGAGE)) And (Index <= High(LUGGAGE)) Then
                GetCardTitle := LUGGAGE[Index];
        CtFacts:
            If (Index >= Low(FACTS)) And (Index <= High(FACTS)) Then
                GetCardTitle := FACTS[Index];
    End;
End;

Function GetCardPoolSize(CardType: TCardType): Integer;
Begin
    GetCardPoolSize := CARD_POOL_SIZES[CardType];
End;

Procedure InitializeCard(Var Card: TCard; CardType: TCardType; Index: Integer);
Begin
    Card.ID := Index;

    Case CardType Of
        CtProfession:
            Card.Title := 'Профессия';
        CtBiology:
            Card.Title := 'Биология';
        CtHealth:
            Card.Title := 'Здоровье';
        CtHobby:
            Card.Title := 'Хобби';
        CtLuggage:
            Card.Title := 'Багаж';
        CtFacts:
            Card.Title := 'Факт';
    End;

    Card.Description := GetCardTitle(CardType, Index);
End;

Procedure GenerateGameSetup(Var Setup: TGameSetup; Seed: Integer;
    Players: TPlayerCount);
Var
    CardType: TCardType;
    I, CardsNeeded: Integer;
    RndValue: Integer;
    SituationsCount: Integer;
Begin
    Setup.Seed := Seed;
    Setup.Players := Players;

    RandSeed := Seed;

    RndValue := Random(15);
    Setup.Catastrophe.Title := CATASTROPHE_TITLE[RndValue];
    Setup.Catastrophe.Description := CATASTROPHE_DESCRIPTION[RndValue];

    SituationsCount := Players Div 2;
    SetLength(Setup.BunkerSituations, SituationsCount);
    For I := 0 To SituationsCount - 1 Do
    Begin
        RndValue := Random(20);
        Setup.BunkerSituations[I].Title := BUNKER_SITUATION_TITLE[RndValue];
        Setup.BunkerSituations[I].Description := BUNKER_SITUATION_DESCRIPTION
            [RndValue];
    End;

    For CardType := Low(TCardType) To High(TCardType) Do
    Begin
        CardsNeeded := Players;
        SetLength(Setup.Cards[CardType], CardsNeeded);

        For I := 0 To CardsNeeded - 1 Do
        Begin
            RndValue := Random(GetCardPoolSize(CardType));
            InitializeCard(Setup.Cards[CardType][I], CardType, RndValue);
        End;
    End;
End;

End.
